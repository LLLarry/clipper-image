var Clipper=function(){"use strict";const t=t=>Object.prototype.toString.call(t).replace(/\[object\s(.+)\]/,"$1").toLowerCase(),e=(t,e=document)=>e.querySelector(t),i=(t,e)=>{let i=0;return function(...s){const n=Date.now();n-i>=e&&(t&&t.apply(this,s),i=n)}},s=(t,e)=>!!e&&(!!t.isSameNode(e)||s(t,e.parentNode)),n=(e,i={},s="")=>{i=null===i?{}:i,s=null===s?"":s;const o=document.createElement(e);for(let[t,e]of Object.entries(i))o.setAttribute(t,e);if("string"===t(s))return o.innerHTML=s,o;for(let e of s)"string"===t(e)?e=document.createHTMLNode(e):"object"===t(e)&&(e=n(e.tagName,e.props,e.children)),o.appendChild(e);return o};function o(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.hypot(i,s)}function c(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}const l=t=>{if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);if("object"==typeof t&&null!==t){const e=new t.constructor;for(let i in t)t.hasOwnProperty(i)&&(e[i]=l(t[i]));return e}return t},r={clipRect:{visible:!1,size:[.5,.5],position:"center",isCanHidden:!0,isCanResize:!0,isCanPosition:!0}},p="IMG_STATUS_IDLE",h="IMG_STATUS_SUCCESS",a="CLIPPER_STATUS_DESTORY",d="CLIPPER_STATUS_RUN";function m(t){if(t.clientX<=this.clipperCvs.getBoundingClientRect().left)return;const e=t.clientX-this.clipRect.scaleStartPosition[0],i=this.copyClipRect.x+e,s=this.copyClipRect.width-e;this.clipRect.x=Math.min(Math.max(i,0),this.clipRect.width+this.clipRect.x),this.clipRect.width=Math.min(Math.max(s,0),this.clipperCvs.width-this.clipRect.x)}function u(t){if(t.clientY<=this.clipperCvs.getBoundingClientRect().top)return;const e=t.clientY-this.clipRect.scaleStartPosition[1],i=this.copyClipRect.y+e,s=this.copyClipRect.height-e;this.clipRect.y=Math.min(Math.max(i,0),this.clipRect.height+this.clipRect.y),this.clipRect.height=Math.min(Math.max(s,0),this.clipperCvs.height-this.clipRect.y)}function g(t){const e=t.clientX-this.clipRect.scaleStartPosition[0],i=this.copyClipRect.width+e;this.clipRect.width=Math.min(Math.max(i,0),this.clipperCvs.width-this.clipRect.x)}function f(t){const e=t.clientY-this.clipRect.scaleStartPosition[1],i=this.copyClipRect.height+e;this.clipRect.height=Math.min(Math.max(i,0),this.clipperCvs.height-this.clipRect.y)}function b(t){const{top:e,left:i}=this.clipperCvs.getBoundingClientRect();let[s,n]=this.clipRect.scaleStartPosition;s-=i,n-=e;const o=t.x-i,c=t.y-e;let l,r,p=Math.abs(o-s),h=Math.abs(c-n);o>=s&&c>=n?(l=s,r=n,p=Math.min(p,this.clipperCvs.width-s),h=Math.min(h,this.clipperCvs.height-n)):o>s&&c<n?(l=s,r=c,p=Math.min(p,this.clipperCvs.width-s),h=Math.min(h,n)):o<s&&c>n?(l=o,r=n,p=Math.min(s,p),h=Math.min(h,this.clipperCvs.height-n)):o<s&&c<n&&(l=o,r=c,p=Math.min(s,p),h=Math.min(h,n)),l=Math.min(Math.max(0,l),this.clipperCvs.width),r=Math.min(Math.max(0,r),this.clipperCvs.height),this.clipRect={...this.clipRect,x:l,y:r,width:p,height:h}}function R(t){if(t.touches.length<2||this.startTouchStatus.touches.length<2)return 0;const[{clientX:e,clientY:i},{clientX:s,clientY:n}]=Array.from(this.startTouchStatus.touches),[{clientX:c,clientY:l},{clientX:r,clientY:p}]=Array.from(t.touches),h=Math.abs(o({x:e,y:i},{x:s,y:n})),a=Math.abs(o({x:c,y:l},{x:r,y:p}));return a>h?1:a<h?-1:0}function v(t){this.clipRect={...this.clipRect,scaleBorder:"none",scaleDirection:"none"};const{clipperCvs:e,clipperClip:i,clipperMask:s,clipperBorderLineLeft:n,clipperBorderLineTop:o,clipperBorderLineRight:c,clipperBorderLineBottom:l,clipperBorderBlockLeftTop:r,clipperBorderBlockRightTop:p,clipperBorderBlockRightBottom:a,clipperBorderBlockLeftBottom:d,clipperSupLineCol1:m,clipperSupLineCol2:u,clipperSupLineRow1:g,clipperSupLineRow2:f}=this;delete this.copyClipRect;const b=t.target;if(b.isSameNode(n)?(this.clipRect.scaleBorder="left",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(o)?(this.clipRect.scaleBorder="top",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(c)?(this.clipRect.scaleBorder="right",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(l)?(this.clipRect.scaleBorder="bottom",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(i)||b.isSameNode(m)||b.isSameNode(u)||b.isSameNode(g)||b.isSameNode(f)?(this.clipRect.scaleBorder="all",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(r)?(this.clipRect.scaleBorder="left-top",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(p)?(this.clipRect.scaleBorder="right-top",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(a)?(this.clipRect.scaleBorder="right-bottom",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):b.isSameNode(d)?(this.clipRect.scaleBorder="left-bottom",this.clipRect.scaleStartPosition=[t.clientX,t.clientY]):(b.isSameNode(e)||b.isSameNode(s))&&this.imageInfo.status===h&&(this.clipRect.scaleBorder="custom",this.clipRect.scaleStartPosition=[t.x,t.y],this.clipRect.isCanHidden&&this.contralClipVisible(!1)),this.copyClipRect=JSON.parse(JSON.stringify(this.clipRect)),!this.clipRect.isCanResize){["left","top","right","bottom","left-top","right-top","right-bottom","left-bottom","custom"].includes(this.clipRect.scaleBorder)&&(this.clipRect.scaleBorder="none")}if(!this.clipRect.isCanPosition){["all"].includes(this.clipRect.scaleBorder)&&(this.clipRect.scaleBorder="none")}}function w(t){if("none"===this.clipRect.scaleBorder)return!1;if("left"===this.clipRect.scaleBorder)m.call(this,t);else if("top"===this.clipRect.scaleBorder)u.call(this,t);else if("right"===this.clipRect.scaleBorder)g.call(this,t);else if("bottom"===this.clipRect.scaleBorder)f.call(this,t);else if("all"===this.clipRect.scaleBorder){const e=t.clientX-this.clipRect.scaleStartPosition[0],i=this.copyClipRect.x+e;this.clipRect.x=Math.min(Math.max(i,0),this.clipperCvs.width-this.clipRect.width);const s=t.clientY-this.clipRect.scaleStartPosition[1],n=this.copyClipRect.y+s;this.clipRect.y=Math.min(Math.max(n,0),this.clipperCvs.height-this.clipRect.height)}else"left-top"===this.clipRect.scaleBorder?(m.call(this,t),u.call(this,t)):"right-top"===this.clipRect.scaleBorder?(g.call(this,t),u.call(this,t)):"right-bottom"===this.clipRect.scaleBorder?(g.call(this,t),f.call(this,t)):"left-bottom"===this.clipRect.scaleBorder?(m.call(this,t),f.call(this,t)):"custom"===this.clipRect.scaleBorder&&(b.call(this,t),this.contralClipVisible(!0));this.drawClipRect()}function y(t){this.clipRect.scaleBorder="none",this.clipRect.scaleDirection="none",this.clipRect.scaleStartPosition=[0,0],delete this.copyClipRect}function C(t){if(!s(this.clipperImgBox,t.target)||this.imageInfo.status!==h)return!1;t.preventDefault(),t.stopPropagation();const e=t.clientX-this.imageInfo.dx-this.clipperCvs.getBoundingClientRect().left,i=t.clientY-this.imageInfo.dy-this.clipperCvs.getBoundingClientRect().top,n=t.clientX-this.clipperCvs.getBoundingClientRect().left,o=t.clientY-this.clipperCvs.getBoundingClientRect().top,c=e/(this.img.width*this.imageInfo.scale),l=i/(this.img.height*this.imageInfo.scale);t.deltaY>0?this.imageInfo.scale=this.imageInfo.scale*(1-this.imageInfo.SCALE_RATE):this.imageInfo.scale=this.imageInfo.scale*(1+this.imageInfo.SCALE_RATE),this.imageInfo.dx=n-c*(this.img.width*this.imageInfo.scale),this.imageInfo.dy=o-l*(this.img.height*this.imageInfo.scale),this.drawImage()}function x(t){t.preventDefault(),"ArrowUp"===t.code?this.imageInfo.dy-=10:"ArrowRight"===t.code?this.imageInfo.dx+=10:"ArrowDown"===t.code?this.imageInfo.dy+=10:"ArrowLeft"===t.code&&(this.imageInfo.dx-=10),this.drawImage()}function S(){if(this.startTouchStatus={touches:event.touches,centerPoiont:null,flag:!1},!s(this.options.el,event.target))return!1;this.startTouchStatus.flag=!0;const{left:t,top:e}=this.clipperCvs.getBoundingClientRect(),[i,n]=Array.from(event.touches);let o=null;i&&n&&(o=c({x:i.clientX-t,y:i.clientY-e},{x:n.clientX-t,y:n.clientY-e})),this.startTouchStatus.centerPoiont=o}function I(){if(!this.startTouchStatus.flag)return!1;event.preventDefault(),event.stopPropagation();let t=null;if(this.startTouchStatus.centerPoiont){const e=R.call(this,event),{x:i,y:s}=this.startTouchStatus.centerPoiont,n=i-this.imageInfo.dx,o=s-this.imageInfo.dy,l=i,r=s,p=n/(this.img.width*this.imageInfo.scale),h=o/(this.img.height*this.imageInfo.scale);1===e?this.imageInfo.scale=this.imageInfo.scale*(1+this.imageInfo.SCALE_RATE):-1===e&&(this.imageInfo.scale=this.imageInfo.scale*(1-this.imageInfo.SCALE_RATE)),this.imageInfo.dx=l-p*(this.img.width*this.imageInfo.scale),this.imageInfo.dy=r-h*(this.img.height*this.imageInfo.scale);const{left:a,top:d}=this.clipperCvs.getBoundingClientRect(),[m,u]=Array.from(event.touches);m&&u&&(t=c({x:m.clientX-a,y:m.clientY-d},{x:u.clientX-a,y:u.clientY-d}))}else{const t=event.touches[0].clientX-this.startTouchStatus.touches[0].clientX,e=event.touches[0].clientY-this.startTouchStatus.touches[0].clientY;this.imageInfo.dx+=t,this.imageInfo.dy+=e}this.startTouchStatus={...this.startTouchStatus,touches:event.touches,centerPoiont:t},this.drawImage()}function E(){}return class{constructor(t={}){this.status="CLIPPER_STATUS_IDLE",this._options=l(t),this.init()}init(){if(this.status===d)return!1;this.status=d,this.options=this.validOptions(this._options),this.options=this.mergeOptions(this.options),this.imageInfo={status:p,SCALE_RATE:.001,scale:1,dx:0,dy:0},this.clipRect=this.createClipRect(this.options.clipRect),this.createElement(),this.initValue(),this.bindEvent()}validOptions(e){if("string"===t(e.el)&&(e.el=document.querySelector(e.el)),!e.el)throw new Error("el must be String„ÄÅElement");return e}mergeOptions(e){if(e.clipRect){if("object"!==t(e))throw new TypeError("options.clipRect must be undefined or Object");for(let[i,s]of Object.entries(e.clipRect))"size"===i?"array"!==t(s)&&(e.clipRect[i]=r.clipRect[i]):"position"===i?"array"!==t(s)&&"center"!==s&&(e.clipRect[i]=r.clipRect[i]):"visible"===i||"isCanHidden"===i||"isCanResize"===i?"boolean"!==t(s)&&(e.clipRect[i]=r.clipRect[i]):"isCanPosition"===i&&"boolean"!==t(s)&&(e.clipRect[i]=r.clipRect[i])}else e.clipRect=r.clipRect;return e}createClipRect(e){const{size:i,position:s,visible:n,isCanHidden:o,isCanResize:c,isCanPosition:l}=e,{offsetWidth:r,offsetHeight:p}=this.options.el,h=i.map(((e,i)=>"number"===t(e)?0===i?e*r:e*p:Number.parseFloat(e)));let a=[0,0];if("array"===t(s)?a=s.map(((e,i)=>"number"===t(e)?0===i?e*r:e*p:Number.parseFloat(e))):(a[0]=r/2-h[0]/2,a[1]=p/2-h[1]/2),a[0]<0||a[0]>r||a[1]<0||a[1]>p)throw new Error("clipRect.positions ‰∏çËÉΩÂ∞è‰∫é0Ôºå‰∏î‰∏çËÉΩÂ§ß‰∫éÂÆπÂô®ÂÆΩÈ´ò");if(h[0]<0||h[0]>r||h[1]<0||h[1]>p)throw new Error("clipRect.size ‰∏çËÉΩÂ∞è‰∫é0Ôºå‰∏î‰∏çËÉΩÂ§ß‰∫éÂÆπÂô®ÂÆΩÈ´ò");if(a[0]+h[0]>r)throw new Error("clipRect‰ΩçÁΩÆÊ®™ÂêëÂùêÊ†á + clipRectÂÆΩ ‰∏çËÉΩÂ§ß‰∫éÂÆπÂô®ÂÆΩÂ∫¶");if(a[1]+h[1]>p)throw new Error("clipRect‰ΩçÁΩÆÁ∫µÂêëÂùêÊ†á + clipRectÈ´ò ‰∏çËÉΩÂ§ß‰∫éÂÆπÂô®È´òÂ∫¶");return{isCanPosition:l,isCanResize:c,isCanHidden:o,visible:n,...this.clipRect||{},x:a[0],y:a[1],width:h[0],height:h[1],scaleBorder:"none",scaleDirection:"none"}}createRandomKey(){return"clipper-"+((t=3)=>{let e="";for(;t>0;)e+=Math.floor(256*Math.random()).toString(16).padStart(2,"0"),t--;return e})()+"-"+Date.now()}createElement(){const t=n("div",{class:"clipper-bg-cvs"}),e=n("canvas",{class:"clipper-cvs"}),i=n("div",{class:"clipper-mask",style:"display: none"}),s=n("div",{class:"clipper-clip",style:"display: none"},'\n\t\t\t\x3c!-- ËæπÊ°Ü --\x3e\n\t\t\t<span class="clipper-border-line clipper-border-line-left"></span>\n\t\t\t<span class="clipper-border-line clipper-border-line-top"></span>\n\t\t\t<span class="clipper-border-line clipper-border-line-right"></span>\n\t\t\t<span class="clipper-border-line clipper-border-line-bottom"></span>\n\t\t\t\x3c!-- ËæπËßíÁÇπ --\x3e\n\t\t\t<span class="clipper-border-block clipper-border-block-left-top"></span>\n\t\t\t<span class="clipper-border-block clipper-border-block-right-top"></span>\n\t\t\t<span class="clipper-border-block clipper-border-block-right-bottom"></span>\n\t\t\t<span class="clipper-border-block clipper-border-block-left-bottom"></span>\n\t\t\t\x3c!-- Ê®™ÂêëËæÖÂä©Á∫ø --\x3e\n\t\t\t<span class="clipper-sup-line clipper-sup-line-row clipper-sup-line-row-1"></span>\n\t\t\t<span class="clipper-sup-line clipper-sup-line-row clipper-sup-line-row-2"></span>\n\t\t\t\x3c!-- Á∫µÂêëËæÖÂä©Á∫ø --\x3e\n\t\t\t<span class="clipper-sup-line clipper-sup-line-col clipper-sup-line-col-1"></span>\n\t\t\t<span class="clipper-sup-line clipper-sup-line-col clipper-sup-line-col-2"></span>\t\n\t\t'),o=n("div",{class:"clipper-img-box",style:"position: relative; z-index:0;"},[t,e,i,s]);this.options.el.appendChild(o);const c=n("style",{class:"clipper-style"},"\n.clipper-img-box {\n\twidth: 100%;\n\theight: 100%;\n\tposition: relative;\n}\n.clipper-img-box canvas, .clipper-bg-cvs{\n\twidth: 100%;\n\theight: 100%;\n}\n.clipper-bg-cvs {\n\tbackground: url('./src/assets/images/bg.png');\n\tposition: absolute;\n\tleft: 0;\n\ttop:  0; \n\twidth: 100%;\n\theight: 100%;\n\tz-index: -1;\n}\n.clipper-cvs {\n\tcursor: pointer;\n\tuser-select: none;\n}\n.clipper-mask {\n\tposition: absolute;\n\tleft: 0;\n\tright: 0;\n\ttop: 0;\n\tbottom: 0;\n\tbackground: #000;\n\topacity: 0.5;\n\tuser-select: none;\n}\n.clipper-clip {\n\tposition: absolute;\n\tleft: 0;\n\twidth: 0;\n\ttop: 0;\n\theight: 0;\n\tcursor: move;\n\tuser-select: none;\n}\n.clipper-border-line {\n\tposition: absolute;\n}\n.clipper-border-line-left::after {\n\tcontent: '';\n\tdisplay: block;\n\theight: 100%;\n\tborder-left: 1px solid #3399ff;\n}\n.clipper-border-line-top::after {\n\tcontent: '';\n\tdisplay: block;\n\theight: 100%;\n\tbackground-color: ;\n\tborder-top: 1px solid #3399ff;\n}\n.clipper-border-line-right::after {\n\tcontent: '';\n\tdisplay: block;\n\theight: 100%;\n\tborder-right: 1px solid #3399ff;\n}\n.clipper-border-line-bottom::after {\n\tcontent: '';\n\tdisplay: block;\n\theight: 100%;\n\tborder-bottom: 1px solid #3399ff;\n}\n.clipper-border-line-left {\n\tleft: 0;\n\ttop: 0;\n\tbottom: 0;\n\twidth: 10px;\n\tcursor: ew-resize;\n}\n.clipper-border-line-top {\n\tleft: 0;\n\ttop: 0;\n\tright: 0;\n\theight: 10px;\n\tcursor: ns-resize;\n}\n.clipper-border-line-right {\n\tright: 0;\n\ttop: 0;\n\tbottom: 0;\n\twidth: 10px;\n\tcursor: ew-resize;\n}\n.clipper-border-line-bottom {\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\theight: 10px;\n\tcursor: ns-resize;\n}\n.clipper-border-block {\n\tposition: absolute;\n\twidth: 10px;\n\theight: 10px;\n\tbackground-color: #3399ff;\n}\n.clipper-border-block-left-top {\n\tleft: 0;\n\ttop: 0;\n\tcursor: nwse-resize;\n}\n.clipper-border-block-right-top {\n\tright: 0;\n\ttop: 0;\n\tcursor: nesw-resize;\n}\n.clipper-border-block-right-bottom {\n\tright: 0;\n\tbottom: 0;\n\tcursor: nwse-resize;\n}\n.clipper-border-block-left-bottom {\n\tleft: 0;\n\tbottom: 0;\n\tcursor: nesw-resize;\n}\n\n.clipper-sup-line {\n\tposition: absolute;\n}\n.clipper-sup-line-row-1 {\n\tleft: 0;\n\ttop: 33.3333333%;\n\twidth: 100%;\n\theight: 5px;\n\tborder-top: 1px dashed rgba(255,255,255,.5);\n}\n.clipper-sup-line-row-2 {\n\tleft: 0;\n\ttop: 66.6666667%;\n\twidth: 100%;\n\theight: 5px;\n\tborder-top: 1px dashed rgba(255,255,255,.5);\n}\n.clipper-sup-line-col-1 {\n\tleft: 33.3333333%;\n\ttop: 0;\n\theight: 100%;\n\tborder-left: 1px dashed rgba(255,255,255,.5);\n}\n.clipper-sup-line-col-2 {\n\tleft: 66.6666667%;\n\ttop: 0;\n\theight: 100%;\n\tborder-left: 1px dashed rgba(255,255,255,.5);\n}\n");document.head.appendChild(c)}removeElement(){this.options.el.innerHTML="";const t=e(".clipper-style");t&&t.parentNode&&t.parentNode.removeChild(t)}initValue(){const t=["clipper-img-box","clipper-bg-cvs","clipper-cvs","clipper-mask","clipper-clip","clipper-border-line-left","clipper-border-line-top","clipper-border-line-right","clipper-border-line-bottom","clipper-border-block-left-top","clipper-border-block-right-top","clipper-border-block-right-bottom","clipper-border-block-left-bottom","clipper-sup-line-row-1","clipper-sup-line-row-2","clipper-sup-line-col-1","clipper-sup-line-col-2"];for(let i of t)this[(s=i,s.replace(/-(\w)/g,((t,e)=>e.toUpperCase())))]=e(`.${i}`,this.options.el);var s;const{offsetWidth:n,offsetHeight:o}=this.options.el;this.options.el.style.setProperty("width",n+"px"),this.options.el.style.setProperty("height",o+"px"),this.clipperCvs.width=n,this.clipperCvs.height=o,this.ctx=this.clipperCvs.getContext("2d"),this.mousedownHandler=v.bind(this),this.mousemoveHandler=i(w.bind(this),16.667),this.mouseupHandler=y.bind(this),this.wheelHandler=C.bind(this),this.keydownHandler=x.bind(this),this.touchstartHandler=S.bind(this),this.touchmoveHandler=I.bind(this),this.touchendHandler=E.bind(this)}drawImage(){if(!this.img)return!1;this.ctx.clearRect(0,0,this.clipperCvs.width,this.clipperCvs.height);const{dx:t,dy:e,scale:i}=this.imageInfo;this.ctx.drawImage(this.img,t,e,this.img.width*i,this.img.height*i),this.drawClipRect()}drawClipRect(){const{clipperClip:t,clipRect:e,imageInfo:i}=this,{dx:s,dy:n}=i;t.style.left=e.x+"px",t.style.top=e.y+"px",t.style.width=e.width+"px",t.style.height=e.height+"px";const o=s-e.x,c=n-e.y;t.style.background=`url('${this.options.imgUrl}') no-repeat ${o}px ${c}px / ${this.img.width*this.imageInfo.scale}px ${this.img.height*this.imageInfo.scale}px`,this.imageInfo.status===h&&this.clipRect.visible&&this.options.onChange&&this.options.onChange(this._getClipImage())}loadImage(t){return this.imageInfo={status:p,SCALE_RATE:.05,scale:1,dx:0,dy:0},this.clipRect=this.createClipRect(this.options.clipRect),this.options.imgUrl=t||this.options.imgUrl,new Promise(((e,i)=>{this.img=this.img||new Image,this.img.onload=()=>{console.log(this),this.imageInfo.status=h,e(this.options.imgUrl),this.imageInfo.dx=this.clipperCvs.width/2-this.img.width*this.imageInfo.scale/2,this.imageInfo.dy=this.clipperCvs.height/2-this.img.height*this.imageInfo.scale/2,this.options.clipRect.visible&&this.contralClipVisible(!0),this.drawImage()},this.img.onerror=t=>{console.log(t),this.imageInfo.status="IMG_STATUS_FAIL",i(t)},this.img.src=t}))}bindEvent(){this.bindMouseEvent(),this.bindMouseWheelEvent(),this.bindKeyEvent(),this.bindTouchEvent()}unbindEvent(){document.removeEventListener("mousedown",this.mousedownHandler),document.removeEventListener("mousemove",this.mousemoveHandler),document.removeEventListener("mouseup",this.mouseupHandler),window.removeEventListener("wheel",this.wheelHandler,{passive:!1}),document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("touchstart",this.touchstartHandler),document.removeEventListener("touchmove",this.touchmoveHandler,{passive:!1}),document.removeEventListener("touchend",this.touchendHandler)}bindMouseEvent(){document.addEventListener("mousedown",this.mousedownHandler),document.addEventListener("mousemove",this.mousemoveHandler),document.addEventListener("mouseup",this.mouseupHandler)}bindMouseWheelEvent(){window.addEventListener("wheel",this.wheelHandler,{passive:!1})}bindKeyEvent(){document.addEventListener("keydown",this.keydownHandler)}bindTouchEvent(){document.addEventListener("touchstart",this.touchstartHandler),document.addEventListener("touchmove",this.touchmoveHandler,{passive:!1}),document.addEventListener("touchend",this.touchendHandler)}contralClipVisible(t){this.clipRect.visible=t,this.clipperMask.style.setProperty("display",this.clipRect.visible?"block":"none"),this.clipperClip.style.setProperty("display",this.clipRect.visible?"block":"none")}_getClipImage(){const t=document.createElement("canvas");t.width=this.clipRect.width,t.height=this.clipRect.height;t.getContext("2d").drawImage(this.clipperCvs,-this.clipRect.x,-this.clipRect.y);for(var e=t.toDataURL("image/png").split(","),i=e[0].match(/:(.*?);/)[1],s=atob(e[1]),n=s.length,o=new Uint8Array(n);n--;)o[n]=s.charCodeAt(n);return new Blob([o],{type:i})}getClipImage(){return new Promise(((t,e)=>{if(!this.options.imgUrl)return e(new Error("ÂõæÁâá‰∏çÂ≠òÂú®"));if(!this.clipRect.visible)return e(new Error("Êú™ÈÄâ‰∏≠ÈúÄË¶ÅÊà™ÂèñÁöÑÂõæÁâá"));try{t(this._getClipImage())}catch(t){return e(t)}}))}setImgFile(t){return this.shortTimeUrl=function(t){var e=null;return void 0!==window.createObjectURL?e=window.createObjectURL(t):void 0!==window.URL?e=window.URL.createObjectURL(t):void 0!==window.webkitURL&&(e=window.webkitURL.createObjectURL(t)),e}(t),console.log(this.shortTimeUrl,this.img),this.loadImage(this.shortTimeUrl)}destory(){if(this.status===a)return!1;this.status=a,this.unbindEvent(),this.removeElement(),window.URL.revokeObjectURL(this.shortTimeUrl),delete this.img}}}();
